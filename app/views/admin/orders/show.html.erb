<div class="container">
  <div class="row">
    <div class="mx-auto">

      <h3>注文履歴詳細</h3>
      <%= form_with model: @selected_order, url: admin_order_path, local: true do |f| %>
      <table>
        <tr>
          <th>購入者</th>
          <th><u><%= link_to @customer.last_name + @customer.first_name, admin_customer_path(@customer), class: "text-reset" %></u></th>
        </tr>
        <tr>
          <th>注文日</th>
          <th><%= @selected_order.created_at.strftime("%Y/%m/%d") %></th>
        </tr>
        <tr>
          <th>配送先</th>
          <th>〒<%= @selected_order.postcode%><%= @selected_order.address%><%= @selected_order.name%></th>
        </tr>
        <tr>
          <th>支払方法</th>
          <th><%= Order.payment_methods_i18n[@selected_order.payment_method] %></th>
        </tr>
        <tr>
          <th>注文ステータス</th>
          <td>
            <%= f.select :status, {"入金待ち" => Order.statuses.key(0), "入金確認" => Order.statuses.key(1), "製作中" => Order.statuses.key(2), "発送準備中" => Order.statuses.key(3), "発送済" => Order.statuses.key(4)}, class: "status" %>
            <%= f.submit "更新", class: 'btn btn-success' %>
            
          </td>
        </tr>
      </table>
      <% end %>

      <table class="table">
        <header>
          <th>商品名</th>
          <th>単価（税込）</th>
          <th>数量</th>
          <th>小計</th>
          <th>製作ステータス</th>
        </header>
        
        
        <% @selected_order.order_items.each do |selected_order_item| %>
        <tr>
          <td><%= selected_order_item.item.name %></td>
          <td><%= number_with_delimiter((selected_order_item.item.with_tax_price).to_i) %></td>
          <td><%= selected_order_item.amount %></td>
          <td><%= number_with_delimiter(selected_order_item.item.price) %></td>
          
          <td>
            <%= form_with model: selected_order_item, url: admin_order_item_path(selected_order_item), method: :patch, local: true do |f| %>
            <%= f.select :status, {"着手不可" => OrderItem.statuses.key(0), "製作待ち" => OrderItem.statuses.key(1),"製作中" => OrderItem.statuses.key(2), "製作完了" => OrderItem.statuses.key(3)}, class: "status" %>
            <%= f.submit  "更新", class: 'btn btn-success' %>
            <% end %>
          </td>
            
          
        
         </tr>
         
        <% end %>
      </table>

  </div>
    <div class="col-xs-4">
      <div>
        <p>
          <strong class="col-xs-3">商品合計</strong>
          ¥<%= (@selected_order.payment - @selected_order.shipping_fee).to_s(:delimited)%>
        </p>
      </div>
      <br>
  
      <div>
        <p>
          <strong class="col-xs-2">送料</strong>
          ¥<%= @selected_order.shipping_fee.to_s(:delimited)%>
        </p>
      </div>
      <br>
  
      <div>
        <p>
          <strong class="col-xs-4">請求金額合計</strong>
          ¥<%= @selected_order.payment.to_s(:delimited) %>
        </p>
      </div>
      <br>
    </div>
  </div>
</div>
